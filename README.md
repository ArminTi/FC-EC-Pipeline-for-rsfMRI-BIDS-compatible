# fMRI Resting State Analysis Pipeline

This is a MATLAB-based master pipeline for processing and analyzing resting state fMRI data. It integrates several powerful toolboxes, including SPM12, CONN, TAPAS to perform comprehensive preprocessing, functional connectivity (FC) analysis, dynamic causal modeling (DCM), and group-level parametric empirical Bayes (PEB) analyses.

## Requirements

Before running the pipeline, ensure the following requirements are met:

- **MATLAB**: R2019a or newer
- **Required packages**: 
  - [SPM12](https://www.fil.ion.ucl.ac.uk/spm/software/spm12/)
  - [CONN Toolbox](https://web.conn-toolbox.org/)
  - [TAPAS](https://github.com/ComputationalPsychiatry)
  - [HEB (Hierarchical Empirical Bayes)](https://github.com/mdgreaves/hierarchical-empirical-Bayes)
  
- **NIfTI Data**: Data should be organized in a BIDS-like format.
- **Directory structure**: Organize your dataset as `fMRI_dataset/BIDS` or adjust the path in the pipeline script.
  
### Optional: Structural Connectivity (SC) Matrix
If you plan to use hierarchical PEB for group-level DCM, you can specify the SC matrix in the `str` variable. (To just see how it works; there is a simulated DMN matrix generated by the function `simulate_DMN_SC()`).

## Installation

1. Download or clone this repository to your local machine.
2. Ensure the required packages are installed and added to the MATLAB path. You can do this manually by using the `addpath` function as shown in the script, or you can automate it via the MATLAB environment.

   ```matlab
   addpath 'C:\path\to\spm12'; 
   addpath 'C:\path\to\conn';
   addpath 'C:\path\to\rDCM-main'; 
   addpath 'C:\path\to\spDCM_Greaves';

